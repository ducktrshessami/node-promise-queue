{"version":3,"sources":["../src/index.ts","../src/PromiseQueueGroup.ts","../src/PromiseQueue.ts"],"sourcesContent":["export * from \"./PromiseQueue\";\nexport * from \"./PromiseQueueGroup\";\nexport * from \"./util\";\n","import { PromiseOrLazy } from \"./util\";\n\nexport class PromiseQueueGroup {\n    public readonly promises: Promise<any>[];\n    private _all: Promise<any[]> | null;\n\n    constructor() {\n        this.promises = [];\n        this._all = null;\n    }\n\n    public get all(): Promise<any[]> {\n        this._all ??= Promise.all(this.promises);\n        return this._all;\n    }\n\n    protected push(promise: Promise<any>): void {\n        this.promises.push(promise);\n        this._all = null;\n    }\n\n    public resolveLazy<T>(promise: PromiseOrLazy<T>): Promise<T> {\n        return typeof promise === \"function\" ? this.all.then(promise) : promise;\n    }\n\n    public add(promise: PromiseOrLazy<any>): void {\n        const p = this.resolveLazy(promise);\n        this.push(p);\n    }\n\n    public clear(): void {\n        this.promises.length = 0;\n        this._all = null;\n    }\n}\n","import { PromiseQueueGroup } from \"./PromiseQueueGroup\";\nimport { PromiseOrLazy } from \"./util\";\n\nexport class PromiseQueue extends PromiseQueueGroup {\n    public static readonly DefaultGroup = \"default\";\n\n    private readonly groups: Map<string, PromiseQueueGroup> = new Map();\n\n    private ensureGroup(name: string): PromiseQueueGroup {\n        let group = this.groups.get(name);\n        if (!group) {\n            group = new PromiseQueueGroup();\n            this.groups.set(name, group);\n        }\n        return group;\n    }\n\n    public add(promise: PromiseOrLazy<any>, groupName: string = PromiseQueue.DefaultGroup): void {\n        const group = this.ensureGroup(groupName);\n        const p = group.resolveLazy(promise);\n        group.add(p);\n        this.push(p);\n    }\n\n    public clear(): void {\n        this.groups.forEach(group => group.clear());\n        this.groups.clear();\n        super.clear();\n    }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACEO,IAAM,oBAAN,MAAwB;AAAA,EACX;AAAA,EACR;AAAA,EAER,cAAc;AACV,SAAK,WAAW,CAAC;AACjB,SAAK,OAAO;AAAA,EAChB;AAAA,EAEA,IAAW,MAAsB;AAC7B,SAAK,SAAS,QAAQ,IAAI,KAAK,QAAQ;AACvC,WAAO,KAAK;AAAA,EAChB;AAAA,EAEU,KAAK,SAA6B;AACxC,SAAK,SAAS,KAAK,OAAO;AAC1B,SAAK,OAAO;AAAA,EAChB;AAAA,EAEO,YAAe,SAAuC;AACzD,WAAO,OAAO,YAAY,aAAa,KAAK,IAAI,KAAK,OAAO,IAAI;AAAA,EACpE;AAAA,EAEO,IAAI,SAAmC;AAC1C,UAAM,IAAI,KAAK,YAAY,OAAO;AAClC,SAAK,KAAK,CAAC;AAAA,EACf;AAAA,EAEO,QAAc;AACjB,SAAK,SAAS,SAAS;AACvB,SAAK,OAAO;AAAA,EAChB;AACJ;;;AC/BO,IAAM,eAAN,MAAM,sBAAqB,kBAAkB;AAAA,EAChD,OAAuB,eAAe;AAAA,EAErB,SAAyC,oBAAI,IAAI;AAAA,EAE1D,YAAY,MAAiC;AACjD,QAAI,QAAQ,KAAK,OAAO,IAAI,IAAI;AAChC,QAAI,CAAC,OAAO;AACR,cAAQ,IAAI,kBAAkB;AAC9B,WAAK,OAAO,IAAI,MAAM,KAAK;AAAA,IAC/B;AACA,WAAO;AAAA,EACX;AAAA,EAEO,IAAI,SAA6B,YAAoB,cAAa,cAAoB;AACzF,UAAM,QAAQ,KAAK,YAAY,SAAS;AACxC,UAAM,IAAI,MAAM,YAAY,OAAO;AACnC,UAAM,IAAI,CAAC;AACX,SAAK,KAAK,CAAC;AAAA,EACf;AAAA,EAEO,QAAc;AACjB,SAAK,OAAO,QAAQ,WAAS,MAAM,MAAM,CAAC;AAC1C,SAAK,OAAO,MAAM;AAClB,UAAM,MAAM;AAAA,EAChB;AACJ;","names":[]}